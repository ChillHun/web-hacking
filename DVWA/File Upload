#File Upload 실습을 기록


#목표
-File Upload 취약점과 대응방법을 이해한다
-File Upload 와 LFI 조합해서 우회하는 방법을 이해한다

#시도한 것
Low단계
1.공격방법
-PHP 웹쉘을 업로드 해서 파일경로를 URL로 접근한다
2.결과
-웹쉘 정상 실행
-cmd 입력가능

Medium단계
1.방어방식
-서버에서 파일타입을 검사 한다
-image/jpeg, image/png만 허용한다
2.공격 방법
-Burp Suit로 업로드 요청을 인터셉트한다
-Content-Type을 image/jpeg로 위조한다
3.결과
-웹쉘 정상 실행
-cmd 입력가능

High단계
1. 방어방식
-확장자 검사
-getimagesize()로 이미지 여부 확인
2.공격방법
-Burp Suit로 업로드 요청을 인터셉트한다
-파일명 뒤에 .jpg를 붙여준다
-파일 내용에 GIF89a(GIF 시그니처로 파일 헤더의 일부)를 추가 해준다
3.결과
-이미지 파일처럼 위장하여 업로드 성공
-.jpg 확장자라서 접근시 PHP 실행 안됨
4.문제점 해결
-LFI 취약점을 이용해 include로 PHP엔진에 태움
-GET 기반 웹쉘이므로 URL에 직접 파라미터 전달

#원인
-서버가 업로드된 파일을 신뢰하고 내용 검증없이 사용하거나 실행 가능한 위치에 저장하기 때문이다

#대응방법
-업로드된 파일을 서버에서 이미지로 재코딩
-업로드 파일명을 랜덤화에서 경로예측 차단
-업로드 디렉터리 실행 권한 제거
-업로드 서버와 웹 애플리케이션 서버 분리 
-


